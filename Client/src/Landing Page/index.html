<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Verde Intel</title>
   <style>
       body {
           font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
           margin: 0;
           padding: 0;
           background-image: url(verdeee.jpg);
           color: #333;
       }

       .page {
           display: none;
       }

       .page.active {
           display: block;
       }

       .container {
           width: 100%;
           max-width: 1200px;
           margin: 0 auto;
           padding: 20px;
           box-sizing: border-box;
       }

       .header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 20px 0;
           border-bottom: 2px solid #e0e0e0;
           margin-bottom: 30px;
       }

       .header-content {
           display: flex;
           align-items: center;
       }

       .logo {
           height: 150px;
           margin-right: 15px;
       }

       .header-buttons {
           display: flex;
           gap: 15px;
       }

       .button {
           padding: 10px 20px;
           border-radius: 15px;
           text-decoration: none;
           font-weight: bold;
           transition: transform 0.3s ease;
           cursor: pointer;
           border: none;
           display: inline-block;
           text-align: center;
       }

       .button.primary {
           background-color: #2e8b57;
           color: white;
       }

       .button.primary:hover {
           background-color: #3cb371;
           transform: translateY(-2px);
       }

       .button.secondary {
           background-color: #f1f1f1;
           color: #2e8b57;
           border: 1px solid #2e8b57;
       }

       .button.secondary:hover {
           background-color: #e2e2e2;
           transform: translateY(-2px);
       }

       /* Hero Section */
       .hero-section {
           background-color: #e8f5e9;
           text-align: center;
           padding: 60px 20px;
           border-radius: 15px;
           margin-bottom: 40px;
       }

       .hero-section h2 {
           font-size: 3em;
           color: #004d00;
           margin: 0 0 10px;
       }

       .hero-section p {
           font-size: 1.2em;
           color: #555;
           max-width: 700px;
           margin: 0 auto 20px;
       }

       .hero-image {
           width: 100%;
           max-width: 800px;
           height: auto;
           margin-top: 30px;
           border-radius: 15px;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
       }


       /* Main Content Grid */
       .main-content {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
           gap: 30px;
       }

       .content-box {
           background-color: #fff;
           padding: 30px;
           border-radius: 15px;
           box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
           transition: box-shadow 0.3s ease;
       }

       .content-box:hover {
           box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
       }

       /* Contact Form */
       .contact-form {
           background-color: #f0f4f7;
           padding: 30px;
           border-radius: 15px;
           margin-top: 40px;
       }

       .contact-form h3 {
           text-align: center;
           color: #006400;
       }

       .form-group {
           margin-bottom: 15px;
       }

       .form-group label {
           display: block;
           margin-bottom: 5px;
           font-weight: bold;
       }

       .form-group input, .form-group textarea {
           width: 100%;
           padding: 10px;
           border: 1px solid #ccc;
           border-radius: 15px;
           box-sizing: border-box;
       }

       .form-group textarea {
           resize: vertical;
       }

       .submit-button {
           width: 100%;
           padding: 12px;
           background-color: #2e8b57;
           color: white;
           border: none;
           border-radius: 15px;
           font-size: 1.1em;
           cursor: pointer;
           transition: background-color 0.3s ease;
       }

       .submit-button:hover {
           background-color: #3cb371;
       }

        /* Enhanced form styling */
       .submit-button:disabled {
           background-color: #ccc;
           cursor: not-allowed;
           opacity: 0.6;
       }

       .form-group input.error {
           border-color: #ff4444;
       }

       .error-message {
           color: #ff4444;
           font-size: 0.9em;
           margin-top: 5px;
       }

       /* Options Page Styling */
       .options-hero {
           background-color: rgba(237, 255, 233, 0.60);
           text-align: center;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
       }

       .options-hero h2 {
           font-size: 3em;
           color: #004d00;
           margin: 0 0 20px;
       }

       .options-hero p {
           font-size: 1.3em;
           color: #555;
           max-width: 600px;
           margin: 0 auto 30px;
       }

       .options-buttons {
           display: flex;
           gap: 20px;
           justify-content: center;
           flex-wrap: wrap;
       }

       .option-button {
           padding: 20px 40px;
           font-size: 1.2em;
           border-radius: 15px;
           text-decoration: none;
           font-weight: bold;
           transition: all 0.3s ease;
           min-width: 150px;
       }

       /* Login/Signup Form Styling */
       .auth-section {
           background-color: rgba(237, 255, 233, 0.60);
           padding: 40px;
           border-radius: 15px;
           margin-bottom: 40px;
           max-width: 500px;
           margin-left: auto;
           margin-right: auto;
       }

       .auth-section h2 {
           text-align: center;
           color: #004d00;
           font-size: 2.5em;
           margin-bottom: 30px;
       }

       .auth-form .form-group {
           margin-bottom: 20px;
       }

       .auth-form .form-group label {
           color: #004d00;
           font-size: 1.1em;
       }

       .auth-form input {
           padding: 15px;
           font-size: 1em;
           border: 2px solid #ccc;
           border-radius: 15px;
           transition: border-color 0.3s ease;
       }

       .auth-form input:focus {
           border-color: #2e8b57;
           outline: none;
       }

       .auth-links {
           text-align: center;
           margin-top: 20px;
           color: #555;
       }

       .auth-links button {
           background: none;
           border: none;
           color: #2e8b57;
           font-weight: bold;
           cursor: pointer;
           text-decoration: underline;
       }

       .auth-links button:hover {
           color: #3cb371;
       }

       /* User Profile Icon */
       .user-profile {
           position: relative;
           cursor: pointer;
       }
       .user-icon {
           width: 40px;
           height: 40px;
           border-radius: 50%;
           background-color: #2e8b57;
           display: flex;
           align-items: center;
           justify-content: center;
           color: white;
           font-weight: bold;
       }

       /* Dropdown Menu */
       .user-menu {
           display: none;
           position: absolute;
           right: 0;
           top: 60px;
           background-color: #fff;
           border: 1px solid #ddd;
           border-radius: 15px;
           padding: 15px;
           width: 200px;
           box-shadow: 0 4px 10px rgba(0,0,0,0.1);
           text-align: center;
           z-index: 100;
       }
       .user-menu p {
           margin: 5px 0;
           font-size: 0.95em;
           color: #333;
       }

       /* Responsive adjustments */
       @media (max-width: 768px) {
           .header {
               flex-direction: column;
               text-align: center;
               align-items: center;
           }
           .header-content {
               flex-direction: column;
               margin-bottom: 15px;
           }
           .logo {
               margin-bottom: 10px;
           }
           .header-buttons {
               margin-top: 15px;
               flex-direction: column;
               width: 100%;
           }
           .button {
               width: 100%;
               text-align: center;
           }
           .hero-section h2, .options-hero h2 {
               font-size: 2em;
           }
           .options-buttons {
               flex-direction: column;
               align-items: center;
           }
           .option-button {
               width: 100%;
               max-width: 300px;
           }
       }
   </style>
</head>
<body>
   <!-- Home Page -->
   <div id="home" class="page active">
       <div class="container">
           <header class="header">
               <div class="header-content">
                   <img src="vERDE.png" alt="AgriTech Solutions Logo" class="logo">
               </div>
               <div class="header-buttons">
                   <a href="#solutions" class="button secondary">Our Solutions</a>
                   <button onclick="showPage('contact')" class="button primary">Get in Touch</button>
               </div>
           </header>

           <section class="hero-section">
               <h2>Harnessing Technology for a Greener Future</h2>
               <p>We provide advanced, data-driven solutions to help farmers increase yield, 
                   conserve resources, and build a more sustainable future for agriculture.<p> 
                   <h3 style="color: #004d00; margin-bottom: 20px;">Join us and become a part of the future of farming!</h3>
                   <button onclick="showPage('options')" class="button primary" style="margin-top: 20px;">Learn More</button>

           <section class="main-content" id="solutions">
               <div class="content-box">
                   <h3>Precision Irrigation</h3>
                   <p>Optimize water usage with smart sensors and automated systems. 
                       Reduce waste and ensure your crops get the exact amount of water they need, when they need it.</p>
               </div>
               <div class="content-box">
                   <h3>Crop Health Monitoring</h3>
                   <p>Use drones and AI to detect plant diseases and nutrient deficiencies early. 
                       Get real-time alerts and actionable insights to protect your harvest.</p>
               </div>
               <div class="content-box">
                   <h3>Automated Harvesting</h3>
                   <p>Our robotic systems can perform tasks like harvesting and planting with unparalleled speed and accuracy, increasing efficiency and reducing labor costs.</p>
               </div>
           </section>
       </div>
   </div>

   <!-- Contact Page -->
   <div id="contact" class="page">
       <div class="container">
           <header class="header">
               <div class="header-content">
                   <a href="#" onclick="showPage('home')">
   <img src="logo1.png" alt="AgriTech Solutions Logo" class="logo">
</a>

               </div>
               <div class="header-buttons">
                   <button onclick="showPage('home')" class="button secondary">Back to Home</button>
                   <button onclick="showPage('options')" class="button primary">Get Started</button>
               </div>
           </header>

           <section class="contact-form">
               <h3>Contact Us to Grow Your Farm</h3>
               <form action="#" method="post">
                   <div class="form-group">
                       <label for="name">Your Name:</label>
                       <input type="text" id="name" name="name" required>
                   </div>
                   <div class="form-group">
                       <label for="email">Email Address:</label>
                       <input type="email" id="email" name="email" required>
                   </div>
                   <div class="form-group">
                       <label for="message">How can we help you?</label>
                       <textarea id="message" name="message" rows="5" required></textarea>
                   </div>
                   <button type="submit" class="submit-button">Send Message</button>
               </form>
           </section>
       </div>
   </div>

   <!-- Options Page -->
   <div id="options" class="page">
       <div class="container">
           <header class="header">
               <div class="header-content">
                   <a href="#" onclick="showPage('home')">
   <img src="logo1.png" alt="AgriTech Solutions Logo" class="logo">
</a>
               </div>
               <div class="header-buttons">
                   <button onclick="showPage('home')" class="button secondary">Back to Home</button>
                   <button onclick="showPage('contact')" class="button primary">Contact Us</button>
               </div>
           </header>

           <section class="options-hero">
               <h2>Get Started with Verde Intel</h2>
               <p>Choose an option below to begin your journey towards smarter, more sustainable farming</p>
               
               <div class="options-buttons">
                   <button onclick="showPage('login')" class="button primary option-button">
                       Login to Your Account
                   </button>
                   <button onclick="showPage('signup')" class="button secondary option-button">
                       Create New Account
                   </button>
               </div>
           </section>

           <section class="main-content">
               <div class="content-box">
                   <h3>Existing Users</h3>
                   <p>Welcome back! Login to access your dashboard, monitor your farm's performance, and manage your smart agriculture systems.</p>
               </div>
               <div class="content-box">
                   <h3>New to Verde Intel?</h3>
                   <p>Join thousands of farmers who have revolutionized their operations with our cutting-edge technology. Sign up today and start your free trial!</p>
               </div>
           </section>
       </div>
   </div>

   <!-- Login Page -->
   <div id="login" class="page">
       <div class="container">
           <header class="header">
               <div class="header-content">
                   <a href="#" onclick="showPage('home')">
   <img src="logo1.png" alt="AgriTech Solutions Logo" class="logo">
</a>

               </div>
               <div class="header-buttons">
                   <button onclick="showPage('options')" class="button secondary">Back</button>
                   <button onclick="showPage('home')" class="button primary">Home</button>
               </div>
           </header>

           <section class="auth-section">
               <h2>Welcome Back!</h2>
               <form id="loginForm" class="auth-form">
                   <div class="form-group">
                       <label for="loginEmail">Email Address</label>
                       <input type="email" id="loginEmail" required placeholder="Enter your email">
                   </div>
                   <div class="form-group">
                       <label for="loginPassword">Password</label>
                       <input type="password" id="loginPassword" required placeholder="Enter your password">
                   </div>
                   <button type="submit" class="submit-button">Login</button>
               </form>
               
               <div class="auth-links">
                   <p>Don't have an account? 
                       <button onclick="showPage('signup')">Sign up here</button>
                   </p>
               </div>
           </section>

           <section class="main-content">
               <div class="content-box">
                   <h3>Access Your Dashboard</h3>
                   <p>Monitor your farm's real-time data, receive alerts, and manage your automated systems all from one centralized platform.</p>
               </div>
               <div class="content-box">
                   <h3>Continue Your Journey</h3>
                   <p>Pick up where you left off with your precision agriculture tools and continue optimizing your farm's performance.</p>
               </div>
           </section>
       </div>
   </div>

   <!-- Sign Up Page -->
   <div id="signup" class="page">
       <div class="container">
           <header class="header">
               <div class="header-content">
                   <a href="#" onclick="showPage('home')">
   <img src="logo1.png" alt="AgriTech Solutions Logo" class="logo">
</a>

               </div>
               <div class="header-buttons">
                   <button onclick="showPage('options')" class="button secondary">Back</button>
                   <button onclick="showPage('home')" class="button primary">Home</button>
               </div>
           </header>

           <section class="auth-section">
               <h2>Join Verde Intel</h2>
               <form class="auth-form" onsubmit="handleSignup(event)">
                   <div class="form-group">
                       <label for="signupName">Full Name</label>
                       <input type="text" id="signupName" required placeholder="Enter your full name">
                   </div>
                   <div class="form-group">
                       <label for="signupEmail">Email Address</label>
                       <input type="email" id="signupEmail" required placeholder="Enter your email">
                   </div>
                   <div class="form-group">
                       <label for="signupPassword">Password</label>
                       <input type="password" id="signupPassword" required placeholder="Create a password">
                   </div>
                   <div class="form-group">
                       <label for="confirmPassword">Confirm Password</label>
                       <input type="password" id="confirmPassword" required placeholder="Confirm your password">
                   </div>
                   <button type="submit" class="submit-button">Create Account</button>
               </form>
               
               <div class="auth-links">
                   <p>Already have an account? 
                       <button onclick="showPage('login')">Login here</button>
                   </p>
               </div>
           </section>

           <section class="main-content">
               <div class="content-box">
                   <h3>Start Your Free Trial</h3>
                   <p>Get 30 days free access to all our premium features including AI crop monitoring, automated irrigation controls, and detailed analytics.</p>
               </div>
               <div class="content-box">
                   <h3>Expert Support</h3>
                   <p>Our team of agricultural experts will help you set up your systems and provide ongoing support to maximize your farm's potential.</p>
               </div>
           </section>
       </div>
   </div>

   <!-- Dashboard Page -->
   <div id="dashboard" class="page">
       <div class="container">
           <header class="header">
               <div class="header-content">
                    <img src="logo1.png" alt="AgriTech Solutions Logo" class="logo">
               </div>
               <div class="header-buttons">
                   <!-- User Profile -->
                   <div class="user-profile" onclick="toggleUserMenu()">
                       <div class="user-icon" id="userIcon">U</div>
                   </div>
                   <div id="userMenu" class="user-menu">
                       <p id="userName">John Doe</p>
                       <p id="userEmail">john@example.com</p>
                       <button onclick="logout()" class="button secondary">Logout</button>
                   </div>
               </div>
           </header>

           <section class="hero-section">
               <h2>Welcome to Your Dashboard</h2>
               <p>Here you can track your farm's performance, manage devices, and access personalized recommendations.</p>
           </section>

           <section class="main-content">
               <div class="content-box">
                   <h3>Farm Overview</h3>
                   <p>Monitor irrigation systems, soil health, and crop growth in real-time.</p>
               </div>
               <div class="content-box">
                   <h3>Notifications</h3>
                   <p>Stay updated with alerts about water usage, weather changes, and system updates.</p>
               </div>
               <div class="content-box">
                   <h3>Account Settings</h3>
                   <p>Update your profile, change your password, and manage subscription plans.</p>
               </div>
           </section>
       </div>
   </div>

   <!-- Core JavaScript -->
   <script>
       // Database simulation using JavaScript objects (in-memory storage)
       let userDatabase = {};
       let currentUser = null;

       function showPage(pageId) {
           // Hide all pages
           const pages = document.querySelectorAll('.page');
           pages.forEach(page => {
               page.classList.remove('active');
           });
           
           // Show selected page
           document.getElementById(pageId).classList.add('active');
       }

       // Enhanced User Management System
       class UserManager {
           constructor() {
               this.loadUsersFromStorage();
               this.loadCurrentSession();
           }

           // Load all registered users from localStorage
           loadUsersFromStorage() {
               const storedUsers = localStorage.getItem('verdeIntelUsers');
               if (storedUsers) {
                   userDatabase = JSON.parse(storedUsers);
               } else {
                   userDatabase = {};
               }
           }

           // Save all users to localStorage
           saveUsersToStorage() {
               localStorage.setItem('verdeIntelUsers', JSON.stringify(userDatabase));
           }

           // Load current user session
           loadCurrentSession() {
               const sessionData = localStorage.getItem('verdeIntelSession');
               if (sessionData) {
                   const session = JSON.parse(sessionData);
                   if (session.isLoggedIn && session.userEmail) {
                       currentUser = userDatabase[session.userEmail];
                       if (currentUser) {
                           this.showDashboard(currentUser);
                       }
                   }
               }
           }

           // Save current session
           saveCurrentSession(user, isLoggedIn = true) {
               const sessionData = {
                   isLoggedIn: isLoggedIn,
                   userEmail: user ? user.email : null,
                   loginTime: new Date().toISOString()
               };
               localStorage.setItem('verdeIntelSession', JSON.stringify(sessionData));
           }

           // Register new user
           registerUser(userData) {
               const { name, email, password } = userData;
               
               // Check if user already exists
               if (userDatabase[email]) {
                   throw new Error('User with this email already exists!');
               }

               // Create new user object
               const newUser = {
                   name: name,
                   email: email,
                   password: password, // In production, this should be hashed
                   registrationDate: new Date().toISOString(),
                   lastLogin: null
               };

               // Add to database
               userDatabase[email] = newUser;
               this.saveUsersToStorage();

               return newUser;
           }

           // Login user
           loginUser(email, password) {
               const user = userDatabase[email];
               
               if (!user) {
                   throw new Error('User not found!');
               }

               if (user.password !== password) {
                   throw new Error('Invalid password!');
               }

               // Update last login
               user.lastLogin = new Date().toISOString();
               this.saveUsersToStorage();

               // Set current user and save session
               currentUser = user;
               this.saveCurrentSession(user, true);

               return user;
           }

           // Logout user
           logoutUser() {
               currentUser = null;
               this.saveCurrentSession(null, false);
           }

           // Show dashboard with user info
           showDashboard(user) {
               document.getElementById('userName').textContent = user.name;
               document.getElementById('userEmail').textContent = user.email;
               
               // Set user icon to first letter of name
               const userIcon = document.getElementById('userIcon');
               if (userIcon) {
                   userIcon.textContent = user.name.charAt(0).toUpperCase();
               }
               
               showPage('dashboard');
           }

           // Get current user
           getCurrentUser() {
               return currentUser;
           }

           // Get all users (for debugging)
           getAllUsers() {
               return userDatabase;
           }
       }

       // Initialize user manager
       const userManager = new UserManager();

       // Handle signup
       async function handleSignup(event) {
           event.preventDefault();
           
           const name = document.getElementById('signupName').value.trim();
           const email = document.getElementById('signupEmail').value.trim().toLowerCase();
           const password = document.getElementById('signupPassword').value;
           const confirmPassword = document.getElementById('confirmPassword').value;

           // Validation
           if (!name || !email || !password) {
               alert('Please fill in all fields!');
               return;
           }

           if (password !== confirmPassword) {
               alert('Passwords do not match!');
               return;
           }

           if (password.length < 6) {
               alert('Password must be at least 6 characters long!');
               return;
           }

           try {
               // Register user in local database
               const newUser = userManager.registerUser({ name, email, password });
               
               // Also try to save to Firebase if available
               if (typeof window.saveUserToDB === 'function') {
                   try {
                       await window.saveUserToDB(newUser);
                       console.log('✅ User also saved to Firebase');
                   } catch (e) {
                       console.warn('⚠️ Could not save to Firebase:', e.message);
                   }
               }

               alert(`Account created successfully for ${name}!`);
               
               // Auto-login the new user
               currentUser = newUser;
               userManager.saveCurrentSession(newUser, true);
               userManager.showDashboard(newUser);

           } catch (error) {
               alert('Error: ' + error.message);
           }
       }


       // Logout function
       function logout() {
           userManager.logoutUser();
           alert("You have been logged out!");
           showPage('home');
           document.getElementById('userMenu').style.display = 'none';
       }

       // Toggle user menu
       function toggleUserMenu() {
           const menu = document.getElementById('userMenu');
           menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
       }

       // Close menu when clicking outside
       document.addEventListener('click', function(event) {
           const profile = document.querySelector('.user-profile');
           const menu = document.getElementById('userMenu');
           if (menu && profile && !profile.contains(event.target) && !menu.contains(event.target)) {
               menu.style.display = 'none';
           }
       });

       // Debug function to check users (remove in production)
       function debugUsers() {
           console.log('All registered users:', userManager.getAllUsers());
           console.log('Current user:', userManager.getCurrentUser());
       }

       // Auto-initialize when page loads
       document.addEventListener('DOMContentLoaded', function() {
           // Check if user is already logged in and show dashboard
           const currentUser = userManager.getCurrentUser();
           if (currentUser) {
               console.log('Auto-login successful for:', currentUser.name);
               userManager.showDashboard(currentUser);
           }
       });
   </script>

   <!-- Firebase Integration -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword, 
        signOut, 
        onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { 
        getFirestore, 
        doc, 
        setDoc 
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
    import { 
        getDatabase, 
        ref, 
        set 
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    // Your Firebase project config
    const firebaseConfig = {
        apiKey: "AIzaSyD0lf8GyLrcwiyRQSvCAMohWWWW71eo4vQ",
        authDomain: "verde-intel.firebaseapp.com",
        projectId: "verde-intel",
        storageBucket: "verde-intel.firebasestorage.app",
        messagingSenderId: "635682332679",
        appId: "1:635682332679:web:c8bd0add02a51864c6caa2",
        databaseURL: "https://verde-intel-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const rtdb = getDatabase(app);

    function formatDateTime() {
    const now = new Date();
    return now.toLocaleString("en-US", {
        dateStyle: "medium",   // Sep 3, 2025
        timeStyle: "short"     // 3:25 PM
    });
}

    // Save user to Firestore + Realtime DB
    async function saveUserToDB(user) {
        try {
            // Firestore (merge keeps old data, updates lastLogin)
            await setDoc(
                doc(db, "users", user.email),
                {
                    name: user.name,
                    email: user.email,
                    registrationDate: user.registrationDate,
                    lastLogin: user.lastLogin
                },
                { merge: true } // ✅ only update changed fields
            );

            // Realtime Database
            await set(ref(rtdb, "users/" + user.email.replace(/\./g, "_")), {
                name: user.name,
                email: user.email,
                registrationDate: user.registrationDate,
                lastLogin: user.lastLogin
            });

            console.log("✅ User saved/updated to Firestore & Realtime DB");
            } catch (error) {
            console.error("Error saving user:", error);
            throw error;
        }
    }


    // Hook into your signup
    window.handleSignup = async (event) => {
        event.preventDefault();
        const name = document.getElementById("signupName").value.trim();
        const email = document.getElementById("signupEmail").value.trim().toLowerCase();
        const password = document.getElementById("signupPassword").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        try {
            // Create user with Firebase Auth
            await createUserWithEmailAndPassword(auth, email, password);
            
            const userData = {
                name: name,
                email: email,
                registrationDate: formatDateTime(),  // ✅ human-readable
                lastLogin: formatDateTime()          // ✅ human-readable
            };


            await saveUserToDB(userData);

            alert("✅ Account created!");
            userManager.showDashboard(userData); // keep your UI logic
        } catch (error) {
            alert("Error: " + error.message);
        }
    };

    // Hook into your login
    // Login
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("loginEmail").value.trim().toLowerCase();
        const password = document.getElementById("loginPassword").value;

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const firebaseUser = userCredential.user;

            const userData = {
                name: firebaseUser.displayName || email.split("@")[0],
                email: firebaseUser.email,
                lastLogin: formatDateTime(),  // ✅ updates on every login
                registrationDate: firebaseUser.metadata?.creationTime 
                                ? new Date(firebaseUser.metadata.creationTime).toLocaleString("en-US", { dateStyle: "medium", timeStyle: "short" }) 
                                : formatDateTime()
            };

            await saveUserToDB(userData);

            alert("✅ Welcome back!");
            userManager.showDashboard(userData);
        } catch (error) {
            alert("Error: " + error.message);
        }
    });


    // Logout
    window.logout = async () => {
        await signOut(auth);
        alert("You have been logged out!");
        showPage("home");
        document.getElementById("userMenu").style.display = "none";
    };

    // Auth state listener (optional)
    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log("User is signed in:", user.email);
        } else {
            console.log("No user signed in.");
        }
    });
</script>
<body>